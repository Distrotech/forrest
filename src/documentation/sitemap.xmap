<?xml version="1.0"?>

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

<!-- =========================== Components ================================ -->

 <map:components>
  <!-- Components used are declared in the cocoon tool section -->
   
  <map:generators   default="file"/>      <!-- available: file, serverpages -->
  <map:transformers default="xslt"/>      <!-- available: xslt              -->
  <map:readers      default="resource"/>  <!-- available: resource          -->
  <map:serializers  default="html"/>      <!-- available: html, xml, links  -->
  <map:matchers     default="wildcard">
   <map:matcher name="wildcard" src="org.apache.cocoon.matching.WildcardURIMatcher"/>
  </map:matchers>
  
 </map:components>

<!-- =========================== Views =================================== -->

 <map:views>
  <map:view name="content" from-label="content">
   <map:serialize type="xml"/>
  </map:view>

  <map:view name="links" from-position="last">
   <map:transform src="stylesheets/filterlinks.xsl"/>
   <map:serialize type="links"/>
  </map:view>

 </map:views>

<!-- =========================== Pipelines ================================= -->

 <map:pipelines>

  <!-- Documentation pipeline -->
  <map:pipeline>
   <map:match pattern="">
    <map:redirect-to uri="index.html"/>
   </map:match>

   <map:match pattern="**book-**.xml">
     <map:generate src="xdocs/{1}book.xml"/>
       <map:transform src="stylesheets/book2menu.xsl">
         <map:parameter name="use-request-parameters" value="true"/>
         <map:parameter name="resource" value="{2}.html"/>
       </map:transform>
     <map:serialize type="xml"/>
   </map:match>

   <map:match pattern="body-todo.xml">
     <map:generate type="file" src="xdocs/todo.xml"/>
     <map:transform src="stylesheets/todo2document.xsl" label="content"/>     
     <map:transform src="stylesheets/document2docbook.xsl"/>
     <map:transform src="stylesheets/docbook2body.xsl"/>
     <map:serialize/>
   </map:match>

   <map:match pattern="body-changes.xml">
     <map:generate type="file" src="xdocs/changes.xml"/>
     <map:transform src="stylesheets/changes2document.xsl" label="content"/>
     <map:transform src="stylesheets/document2docbook.xsl"/>
     <map:transform src="stylesheets/docbook2body.xsl"/>
     <map:serialize/>
   </map:match>

   <map:match pattern="body-faq.xml">
     <map:generate type="file" src="xdocs/faq.xml"/>
     <map:transform src="stylesheets/faq2document.xsl" label="content"/>
     <map:transform src="stylesheets/document2docbook.xsl"/>
     <map:transform src="stylesheets/docbook2body.xsl"/>
     <map:serialize/>
   </map:match>

   <map:match pattern="body-**.xml">
     <map:generate src="xdocs/{1}.xml"/>
     <map:transform src="stylesheets/document2docbook.xsl"/>
     <map:transform src="stylesheets/docbook2body.xsl"/>
     <map:serialize/>
   </map:match>

   <map:match pattern="*.xml">
    <map:aggregate element="site">
     <map:part src="cocoon:/book-{1}.xml"/>
     <map:part src="cocoon:/body-{1}.xml" label="content"/>
    </map:aggregate>
    <map:transform src="stylesheets/site2xhtml.xsl">
       <map:parameter name="use-request-parameters" value="true"/>
       <map:parameter name="header" value="graphics/{1}-header.jpg"/>
     </map:transform>
    <map:serialize/>
   </map:match>

   <map:match pattern="*.html">
    <map:aggregate element="site">
     <map:part src="cocoon:/book-{1}.xml"/>
     <map:part src="cocoon:/body-{1}.xml" label="content"/>
    </map:aggregate>
    <map:transform src="stylesheets/site2xhtml.xsl">
       <map:parameter name="use-request-parameters" value="true"/>
       <map:parameter name="header" value="graphics/{1}-header.jpg"/>
     </map:transform>
    <map:serialize/>
   </map:match>

   <map:match pattern="**/*.html">
    <map:aggregate element="site">
     <map:part src="cocoon:/{1}/book-{1}/{2}.xml"/>
     <map:part src="cocoon:/body-{1}/{2}.xml" label="content"/>
    </map:aggregate>
    <map:transform src="stylesheets/site2xhtml.xsl">
       <map:parameter name="use-request-parameters" value="true"/>
       <map:parameter name="header" value="graphics/{2}-header.jpg"/>
     </map:transform>
    <map:serialize/>
   </map:match>

   <!-- ================  Static  =========================== -->

   <map:match pattern="**.txt">
    <map:read src="xdocs/{1}.txt" mime-type="text/plain"/>
   </map:match>

   <map:match pattern="**resources/**.js">
     <map:read src="stylesheets/{2}.js" mime-type="application/javascript"/>
   </map:match>

   <map:match pattern="**.css">
    <map:read src="{1}.css" mime-type="text/css"/>
   </map:match>

   <map:match pattern="**images/*.png">
    <map:read src="images/{2}.png" mime-type="image/png"/>
   </map:match>

   <map:match pattern="**images/*.jpg">
    <map:read src="images/{2}.jpg" mime-type="image/jpeg"/>
   </map:match>

   <map:match pattern="**images/*.gif">
    <map:read src="images/{2}.gif" mime-type="image/gif"/>
   </map:match>

  </map:pipeline>
 </map:pipelines>

</map:sitemap>
