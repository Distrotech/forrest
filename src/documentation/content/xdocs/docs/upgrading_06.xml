<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright 2002-2004 The Apache Software Foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.2//EN" "http://forrest.apache.org/dtd/document-v12.dtd">
<document> 
  <header> 
    <title>Upgrading to Forrest 0.6</title> 
  </header> 
  <body> 
    <section>
      <title>Introduction</title>
      <p>
      This page describes changes to Forrest that affect people who are
      upgrading from 0.4 and earlier to the 0.6 version.
      Please post your upgrade experiences to either the
      <link href="site:mail-lists/forrest-dev">dev</link> or
      <link href="site:mail-lists/forrest-user">user</link>
      mailing lists.
      As more experience is gained, this document will be updated.  
      </p>
      <p>
      See also the notes for the
      <link href="site:upgrading_05">previous</link> upgrade.
      </p>
    </section>

    <section>
      <title>New Features</title>
      <p>
        The following list shows some of the key new features for Forrest 0.6
        (for the full list of changes, see the
        <link href="site:changes">change log</link>).
      </p>
      <ul>
        <li>copyless</li>
        <li>SVN</li>
        <li>skinconf DTD</li>
        <li>Forrestbot</li>
      </ul>
    </section>

    <section>
      <title>Run a clean target after upgrade</title>
      <p>To avoid any issue with old classes being loaded, run a
        '<code>forrest clean</code>' in your project directory, after you
        upgraded to this version.
      </p>
    </section>

    <section id="copyless">
      <title>Copyless</title>
      <p>
      In essence, Forrest does not create a dist anymore, and uses 
      itself in place. No more useless copying to a separate build space,
      no more backcopying bugfixes, all is used live.
      It improves the build process a lot.
      </p>

      <p>
      To use the new Forrest, run 'build.sh' or 'build.bat' as you always have done,
      and then change FORREST_HOME to point to forrest/src/core instead of 
      .../build/dist/shbat. Also make sure PATH gets updated to use the new 
      $FORREST_HOME/bin
      </p>
    </section>

    <section id="skin-config-1">
      <title>Private skins might need changes to document2html.xsl</title>
      <p>
      Moved all references to //skinconfig out of the document2html.xsl
      into the site2xhtml.xsl file. If you have your own skins that were
      referencing "$config" or "//skinconfig" in the document2html.xsl
      then you need to make similar changes.
      For further information, see Issue
      <link href="http://issues.cocoondev.org/jira/secure/ViewIssue.jspa?key=FOR-146">FOR-146</link>.
      </p>
    </section>
    
    <section id="antproxy">
      <title>forrest.antproxy.xml is obsolete in favor of Ant's &lt;import&gt; task</title>
      <p>
      Projects that use <code>forrest.antproxy.xml</code> via and Ant build
      task to invoke Forrest, will receive
      an error message directing them to this document.
      Please see the <link href="site:your-project/invoking_from_ant">Invoking
      Forrest from Ant</link> documentation for instructions on how to use
      the &lt;import&gt; task.
      </p>
    </section>
    
    <section id="ehtml">
      <title>Deprecation of .ehtml</title>
      <p>
      The .ehtml input file format has been deprecated and will likely be
      removed in the next release.
      Please convert all .ehtml files to .ihtml.
      If you do '<code>forrest seed</code>' there is a sample ihtml file.
      </p>
    </section>
    
    <section id="forrestbot">
      <title>New forrestbot</title>
      <p>
      The forrestbot and the forrestbot web interface have been completely
      rewritten.  There is no
      direct way to convert old configurations to new configurations.
      Please see the <link href="site:forrestbot">forrestbot
      documentation</link> for instructions to create buildfiles that work
      with the new forrestbot.
      </p>
    </section>
    
    <section id="dtd">
      <title>New DTDs</title>
      <p>
      Updated all v1.2 DTDs to become v1.3 DTDs (forward compatibility:
      v1.2 docs will work fine as V1.3). The main change is the addition
      of a @class attribute to every element, which enables the "extra-css"
      section in the skinconf to be put to good use.
      </p>
      <p>
      Updated the v2.0a DTDs to become v2.0 DTDs (forward incompatibility:
      v1.2/1.3 docs are not forward-compatible as V2.0).
      </p>
    </section>

    <section id="catalog">
      <title>SystemIdentifiers for DTDs changed to forrest.apache.org</title>
      <p>
        Everyone should still continue to use the
        <link href="site:catalog">Catalog Entity Resolver</link>
        and that certainly still operates at the core of Forrest using the
        well-defined PublicIdentifiers.
        However, some impoverished XML tools do not, so they need to be able
        to get the DTDs from the website. Some other tools rely on the System
        Identifier rather than the Public Identifer. See Forrest Issue
        <link href="http://issues.cocoondev.org/jira/secure/ViewIssue.jspa?key=FOR-107">FOR-107</link>.
      </p>
      <p>
        In previous versions of Forrest, and maybe in your application if
        you copied the fresh-site xdocs, there were inconsistent
        SystemIdentifiers. Some used local filenames, others used
        apache.org/forrest/dtd/ URIs. In v0.6 we changed to use
        System Identifiers at forrest.apache.org/dtd/ as resource URLs.
        You do not need to change them because you are using the entity
        resolver, but to remain consistent, it probably is best.
      </p>
      <p>
        Beware if you have a catalog where the mapping is not declared properly.
        The Catalog Entity Resolver will miss the local mapping and happily
        go to the network to get the DTDs. That would cause Forrest to appear
        to be slow for you, yet it will still operate properly. While we are
        on that topic, if you use the XSLT document() function - there is a 
        <link href="http://issues.apache.org/bugzilla/show_bug.cgi?id=28341">Xalan bug 28341</link>
        for DTD resolution via document() - please help to fix it.
        Also see the 
        <link href="http://cocoon.apache.org/2.1/faq/faq-xslt.html">Cocoon FAQ</link>.
      </p>
    </section>

    <section id="local-catalog">
      <title>Projects can use a local CatalogManager.properties</title>
      <p>
      You can add a local CatalogManager.properties to your 
      project.classes-dir to define your additional catalogs for DTDs
      and other entities.
      </p>
      <p>
      If you do not add such a configuration file then there will be a
      harmless message on startup "CatalogManager.properties not found".
      </p>
    </section>

    <section>
      <title>To be continued...</title>
      <p>...as more issues are discovered/remembered :)  Please send feedback
      to the
      <link href="site:mail-lists/forrest-dev">mailing list</link>.</p>
    </section>
  </body>
</document>
