<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright 2002-2005 The Apache Software Foundation or its licensors,
  as applicable.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V2.0//EN" "http://forrest.apache.org/dtd/document-v20.dtd">
<document> 
  <header> 
    <title>Welcome to the org.apache.forrest.plugin.input.Daisy Plugin</title> 
  </header> 
  <body> 
    <section>
      <title>Apache Forrest - org.apache.forrest.plugin.input.Daisy Plugin</title>
      <p>This plugin retrieves documents from a 
      <a href="http://www.cocoondev.org/daisy">Daisy</a>
      repository.</p>
    </section>
    
    <section>
      <title>Usage</title>
      
      <warning>The 0.3-Dev Daisy plugin does not allow you to mix
      Daisy content with non-Daisy content. You should continue to
      use version 0.2 if you need to mix content from multiple sources.
      This is a temporary restriction.</warning>
      
      <p>This plugin allows content to be retrieved from a 
      <a href="http://www.cocoondev.org/daisy/">Daisy CMS repository</a>
      and displayed alongside any other Forrest content. Unlike many
      other plugins there is some configuraiton of your project requried.</p>
      
      <section>
        <title>Locationmap Configuration</title>
      
        <p>The project locationmap for a Daisy generated site is automatically
        created from the daisy navigation documents. In order to tell Forrest
        how to generate these documents you must add a matcher to your
        project sitemap as follows:</p>
      
        <source><![CDATA[
<map:match pattern="locationmap-project.xml">
  <map:generate src="http://username:password@rop.domain.org:9263/publisher/blob?documentId=NAVIGATION-DOCUMENT-ID&amp;version=live&amp;partType=1"/>
  <map:transform src="{forrest:plugins}/org.apache.forrest.plugin.input.Daisy/resources/stylesheets/navigation-to-locationmap.xsl">
    <map:parameter name="publisherURL" value="http://username:password@repo.domain.org:9263/publisher/"/>
    <map:parameter name="pathPrefix" value="/"/>
  </map:transform>
  <map:transform rtype="xinclude"/>
  <map:serialize type="xml"/>
</map:match>
        ]]></source>
        
        <p>The <code>pathPrefix</code> is  a prefix added to all paths to documents
        that are to be retrieved from the Daisy repository. It can, of course, be ommitted
        in which case there will no prefix.</p>
        
        <p>If your site needs to provide additional locationmap entires it can
        do so by including them in 
        <code>PROJECT_HOME/src/documentation/locationmap-daisy-include.xml</code>.
        The matchers in this file will override any of the auto-generated matchers
        from the Daisy navigation file.</p>
        
        <note>It is recomended that the pipelines that generate the locationmap
        are cached for at least 1 hour. This is because it is computationally
        expensive to regenerate these files. A future version of this plugin will provide
        a more flexible caching mechanism. But for now you need to force a refresh 
        during development.</note>
        
      </section>
      
      <section>
        <title>Using Daisy Navigation Documents</title>
        <p>It is possible to use a daisy navigation document in place of a local
        site.xml file. However, you may want to mix content from different sources
        by adding other entries to site.xml, ones that are not sourced from the 
        Daisy navigation document. Therefore, you still need a site.xml file.</p>
        
        <p>A minimal site.xml file for your project would be:</p>
        
        <source><![CDATA[
<site label="MyProj" href="" 
  xmlns="http://apache.org/forrest/linkmap/1.0" 
  xmlns:xi="http://www.w3.org/2001/XInclude" 
  tab="">
  <xi:include href="cocoon://1208.daisy.navigation"/>
</site>
        ]]></source>
        
        <p>Note that we use <code>xi:include</code> to include a navigation
        document in the site.xml file, in this case the document retrieved has
        id 1208. By using include in this way the site editor is free to use
        site.xml to reference content from other sources.</p>
        
        <note>As with the locationmap generation, the pipelines that generate the site.xml
        snippets are cached for at least 1 hour. This is because it is computationally
        expecnsive to regenerate these files. A future version of this plugin will provide
        a more flexible caching mechanism. But for now you need to force a refresh 
        during development.</note>
      </section>
      
      <section>
        <title>Retrieving RAW content</title>
        <p>If you want to retrieve the raw, unprocessed XML from
        Daisy simply request the file with a <code>.daisy.source</code>
        extenstion.</p>
      </section>
    </section>
      
      <section>
        <title>Filtering Content</title>
        
        <p>You may not have full control of the content in the repository, or
        you may wish to supress the presentation of some of the parts, for 
        example, the fields within the repository. There are two points at 
        which you can filter the content, at the point of retrieval (called a
        pre-filter) and once the file has been converted to the internal 
        Forrest format (called a post-filter).</p>
        
        <section>
          <title>Pre-Filters</title>
          
          <p>Pre-Filters are applied to the XML retrieved from the 
          Daisy repository. To achieve this you can 
          provide an XSL file called <code>daisy/preFilter.xsl</code> in your 
          projects stylesheet directory (default location is 
          <code>PROJECT_HOME/src/documentation/resources/stylesheets</code>).</p>
        
        </section>
        
        <section>
          <title>Post-Filters</title>
          
          <p>Post-Filters are applied to the XDoc generated by 
          Forrest. To achieve this you can 
          provide an XSL file called <code>daisy/postFilter.xsl</code> in your 
          projects stylesheet directory (default location is 
          <code>PROJECT_HOME/src/documentation/resources/stylesheets</code>).</p>
        
          <p>The postFilter XSL file operates on the XDoc generated by Forrest. 
          If you wish to look at this format of the document simply request 
          the page with an <code>.xml</code> extension.</p>
        
    </section>
  </section>
  </body>
</document>