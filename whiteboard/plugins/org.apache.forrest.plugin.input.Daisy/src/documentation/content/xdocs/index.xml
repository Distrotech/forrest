<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright 2002-2004 The Apache Software Foundation or its licensors,
  as applicable.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V2.0//EN" "http://forrest.apache.org/dtd/document-v20.dtd">
<document> 
  <header> 
    <title>Welcome to the org.apache.forrest.plugin.input.Daisy Plugin</title> 
  </header> 
  <body> 
    <section>
      <title>Apache Forrest - org.apache.forrest.plugin.input.Daisy Plugin</title>
      <p>This plugin retrieves documents from a 
      <a href="http://www.cocoondev.org/daisy">Daisy</a>
      repository.</p>
    </section>
    
    <section>
      <title>Usage</title>
      
      <p>Perhaps the most important thing to realise about this plugin is that 
      there is no relationship between the Forrest URL space and the URL space
      defined in the Daisy repository. That is the path to and the name of each
      document within Forrest needs not be the same as the path to and the name
      of the document within the Daisy repository.</p>
      
      <p>This enables the repository to be structured in a way that is
      appropriate for it's editors and the Forrest document collection can
      be structured in a way that is appropriate for the target audience. In
      fact, it is possible to use the same document from a Daisy repository in
      multiple Forrest collections each using a completely different URL 
      space that is custom designed for the end user of the document
      collection.</p> 
      
      <section>
        <title>Locationmap</title>
      
        <p>In order to tell Forrest which document to retrieve from the
        repository you need to make use of the locationmap in Forrest. Your
        project must therefore provide a locationmap similar to the one 
        that follows.</p>
      
        <source><![CDATA[
<locationmap xmlns="http://apache.org/forrest/locationmap/1.0">

  <components>
    <matchers default="lm">
      <matcher 
        name="lm" 
        src="org.apache.forrest.locationmap.WildcardLocationMapHintMatcher"/>
    </matchers>
  </components>
  
  <locator>
   
     <match pattern="index.xml">
         <location src="cocoon://908.daisy.xml" />
     </match>
   
     <match pattern="*.daisy.source">
         <location src="http://username:password@repository.domain.com:9263/publisher/documentPage?documentId={1}&amp;includeNavigation=false&amp;locale=en_US&amp;version=live" />
     </match>
   
     <match pattern="*.daisy.img">
         <location src="http://username:password@repository.domain.com:9263/publisher/blob?documentId={1}&amp;version=live&amp;partType=3" />
     </match>
   
     <match pattern="*.daisy.navigation">
         <location src="http://username:password@repository.domain.com:9263/publisher/blob?documentId={1}&amp;version=live&amp;partType=1" />
     </match>
 
  </locator>
</locationmap>
        ]]></source>
        
        <p>The first match (<code>pattern="index.xml"</code>) will redirect
        the request for index.xml to a named document
        in the daisy repository. If you provide your index.xml file locally then omit 
        this matcher.</p>
        
        <p>The next match (<code>pattern="*.daisy.source"</code>) is used by the plugin
        to resolve requests for daisy documents.</p>
        
        <p>The next match (<code>pattern="*.daisy.img"</code>) is used by the plugin
        to resolve requests for images stored in the daisy repository.</p>
                
        <p>The next match (<code>pattern="*.daisy.navigation"</code>) is used by the plugin
        to resolve requests for daisy navigation documents.</p>
        
        <note>In a future version of Forrest it planned to allow plugins to provide 
        locationmaps of their own. Therefore, the need for a project to provide this
        locationmap will be removed.</note>
      </section>
      
      <section>
        <title>Using Daisy Navigation Documents</title>
        <p>It is possible to use a daisy navigation document in place of a local
        site.xml file. However, in order to allow other content to be added to the
        forrest publication without requiring write access to the Daisy repository
        your project still requries a site.xml file.</p>
        
        <p>A minimal site.xml file for your project would be:</p>
        
        <source><![CDATA[
<site label="MyProj" href="" 
  xmlns="http://apache.org/forrest/linkmap/1.0" 
  xmlns:xi="http://www.w3.org/2001/XInclude" 
  tab="">
  <xi:include href="cocoon://1208.daisy.navigation"/>
</site>
        ]]></source>
      
        <p>Note that we use <code>xi:include</code> to include a navigation
        document in the site.xml file, in this case the document retrieved has
        id 1208. By using include in this way the site editor is free to use
        site.xml to reference content from other sources.</p>
      </section>
      
      <section>
        <title>Retrieving RAW content</title>
        <p>If you want to retrieve the raw, unprocessed XML from
        Daisy simply request the file with a <code>.daisy.source</code>
        extenstion.</p>
      </section>
    </section>
      
      <section>
        <title>Filtering Content</title>
        <p>You may not have full control of the content in the repository, or
        you may wish to supress the presentation of some of the parts, for 
        example, the fields within the repository. There are two points at 
        which you can filter the content, at the point of retrieval (called a
        pre-filter) and once the file has been converted to the internal 
        Forrest format (called a post-filter).</p>
        
        <section>
          <title>Pre-Filters</title>
          
          <p>Pre-Filters are applied to the XML retrieved from the 
          Daisy repository. To achieve this you can 
          provide an XSL file called <code>daisy/preFilter.xsl</code> in your 
          projects stylesheet directory (default location is 
          <code>PROJECT_HOME/src/documentation/resources/stylesheets</code>).</p>
        
        </section>
        
        <section>
          <title>Post-Filters</title>
          
          <p>Post-Filters are applied to the XDoc generated by 
          Forrest. To achieve this you can 
          provide an XSL file called <code>daisy/postFilter.xsl</code> in your 
          projects stylesheet directory (default location is 
          <code>PROJECT_HOME/src/documentation/resources/stylesheets</code>).</p>
        
          <p>The postFilter XSL file operates on the XDoc generated by Forrest. 
          If you wish to look at this format of the document simply request 
          the page with an <code>.xml</code> extension.</p>
        
    </section>
  </section>
  </body>
</document>